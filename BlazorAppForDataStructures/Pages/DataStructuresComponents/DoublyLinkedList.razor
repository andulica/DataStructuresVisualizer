@page "/doublyLinkedList"
@inject IJSRuntime JSRuntime
@using DataStructuresVisualizer.DataStructures.DoublyLinkedListFile

<h3>Doubly Linked List Operations</h3>

<div class="operation-selection">
    <select @bind="selectedAction">
        <option value="insertAtPosition">Insert At Position</option>
        <option value="prepend">Prepend</option>
        <option value="append">Append</option>
        <option value="search">Search</option>
        <option value="remove">Remove</option>
        <option value="create">Create</option>
        <option value="traverse">Traverse</option>
    </select>
    @switch (selectedAction)
    {
        case "insertAtPosition":
            <div class="insertion-fields">
                <label>Input Value:</label>
                <input type="number" @bind="inputValue" placeholder="Enter Value" />
                <label>Insert Position:</label>
                <input type="number" @bind="insertPosition" placeholder="Enter Position" />
                <button class="custom-button" @onclick="PerformInsertion" disabled="@isOperationInProgress">Insert</button>
            </div>
            break;
        case "prepend":
            <div class="insertion-fields">
                <label>Input Value:</label>
                <input type="number" @bind="inputValue" placeholder="Enter Value" />
                <button class="custom-button" @onclick="PrependValue" disabled="@isOperationInProgress">Prepend</button>
            </div>
            break;
        case "append":
            <div class="insertion-fields">
                <label>Input Value:</label>
                <input type="number" @bind="inputValue" placeholder="Enter Value" />
                <button class="custom-button" @onclick="AppendValue" disabled="@isOperationInProgress">Append</button>
            </div>
            break;
        case "search":
            <div class="insertion-fields">
                <label>Input Value:</label>
                <input type="number" @bind="inputValue" placeholder="Enter Value" />
                <button class="custom-button" @onclick="SearchValue" disabled="@isOperationInProgress">Search</button>
            </div>
            break;
        case "remove":
            <div class="insertion-fields">
                <label>Input Value:</label>
                <input type="number" @bind="inputValue" placeholder="Enter Value" />
                <button class="custom-button" @onclick="RemoveValue" disabled="@isOperationInProgress">Remove</button>
            </div>
            break;
        case "create":
            <div class="create-fields">
                <label>Input Value:</label>
                <input type="number" @bind="inputValue" placeholder="Enter Value" />
                <button class="custom-button" @onclick="CreateDoublyLinkedList" disabled="@isOperationInProgress">Create List</button>
            </div>
            break;
        default:
            break;
    }
</div>

<div id="dll-display"></div>

@code {
    private string selectedAction = "create";
    private int inputValue;
    private int insertPosition;
    private bool isOperationInProgress = false;

    private DoublyLinkedList<int> doublyLinkedList = new DoublyLinkedList<int>();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var dllData = ConvertListToJavaScriptFormat(doublyLinkedList);
            await JSRuntime.InvokeVoidAsync("drawDoublyLinkedList", dllData);
        }
    }

    private async Task PerformInsertion()
    {
        isOperationInProgress = true;
        try
        {
            await Task.Delay(500);
            doublyLinkedList.InsertAt(inputValue, insertPosition);
            var dllData = ConvertListToJavaScriptFormat(doublyLinkedList);
            await JSRuntime.InvokeVoidAsync("drawDoublyLinkedList", dllData);
        }
        catch (Exception ex)
        {
            // Handle exception
        }
        finally
        {
            isOperationInProgress = false;
        }
    }

    private async Task PrependValue()
    {
        isOperationInProgress = true;
        try
        {
            await Task.Delay(500);
            doublyLinkedList.Prepend(inputValue);
            var dllData = ConvertListToJavaScriptFormat(doublyLinkedList);
            await JSRuntime.InvokeVoidAsync("drawDoublyLinkedList", dllData);
        }
        catch (Exception ex)
        {
            // Handle exception
        }
        finally
        {
            isOperationInProgress = false;
        }
    }

    private async Task AppendValue()
    {
        isOperationInProgress = true;
        try
        {
            await Task.Delay(500);
            doublyLinkedList.Append(inputValue);
            var dllData = ConvertListToJavaScriptFormat(doublyLinkedList);
            await JSRuntime.InvokeVoidAsync("drawDoublyLinkedList", dllData);
        }
        catch (Exception ex)
        {
            // Handle exception
        }
        finally
        {
            isOperationInProgress = false;
        }
    }

    private async Task SearchValue()
    {
        isOperationInProgress = true;
        try
        {
            await JSRuntime.InvokeVoidAsync("searchValueInDLL", inputValue, 1000); // 1000ms delay
        }
        catch (Exception ex)
        {
            // Handle exception
        }
        finally
        {
            isOperationInProgress = false;
        }
    }

    private async Task RemoveValue()
    {
        isOperationInProgress = true;
        try
        {
            await Task.Delay(500); // Simulate delay
            doublyLinkedList.Delete(inputValue);
            await JSRuntime.InvokeVoidAsync("removeValueInSll", inputValue, 1000); // 1000ms delay
        }
        catch (Exception ex)
        {
            // Handle exception
        }
        finally
        {
            isOperationInProgress = false;
        }
    }

    private async Task CreateDoublyLinkedList()
    {
        isOperationInProgress = true;
        try
        {
            await Task.Delay(500); // Simulate delay
            for (int i = 0; i < inputValue; i++)
            {
                doublyLinkedList.Append(i + 1); // Simulate appending nodes
            }
            var linkedListData = ConvertListToJavaScriptFormat(doublyLinkedList);
            await JSRuntime.InvokeVoidAsync("drawDoublyLinkedList", linkedListData);
        }
        catch (Exception ex)
        {
            // Handle exception
        }
        finally
        {
            isOperationInProgress = false;
        }
    }

    private List<object> ConvertListToJavaScriptFormat(DoublyLinkedList<int> list)
    {
        var nodes = new List<object>();
        var currentNode = list.Head;
        while (currentNode != null)
        {
            nodes.Add(new
            {
                value = currentNode._data,
                next = currentNode.Next != null ? currentNode.Next.Id : (Guid?)null,
                prev = currentNode.Prev != null ? currentNode.Prev.Id : (Guid?)null,
                id = currentNode.Id
            });
            currentNode = currentNode.Next;
        }
        return nodes;
    }
}